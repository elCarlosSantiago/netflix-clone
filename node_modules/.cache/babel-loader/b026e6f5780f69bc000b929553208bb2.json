{"ast":null,"code":"import _regeneratorRuntime from\"/Users/carlossantiagonevett/Documents/selfStudy/netflix-clone/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/carlossantiagonevett/Documents/selfStudy/netflix-clone/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/carlossantiagonevett/Documents/selfStudy/netflix-clone/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useSelector}from'react-redux';import db from'../firebase';import'./../styles/PlansScreen.css';import{loadStripe}from'@stripe/stripe-js';import{selectUser}from'./../features/userSlice';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function PlansScreen(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),products=_useState2[0],setProducts=_useState2[1];var user=useSelector(selectUser);var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),subscription=_useState4[0],setSubscription=_useState4[1];useEffect(function(){db.collection('customers').doc(user.uid).collection('subscriptions').get().then(function(querySnapshot){querySnapshot.forEach(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(subscription){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setSubscription({role:subscription.data().role,current_period_end:subscription.data().current_period_end.seconds,current_period_start:subscription.data().current_period_start.seconds});case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());});},[user.uid]);console.log(subscription);useEffect(function(){db.collection('products').where('active','==',true).get().then(function(querySnapshot){var products={};querySnapshot.forEach(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(productDoc){var priceSnap;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:products[productDoc.id]=productDoc.data();_context2.next=3;return productDoc.ref.collection('prices').get();case 3:priceSnap=_context2.sent;priceSnap.docs.forEach(function(price){products[productDoc.id].prices={priceId:price.id,priceData:price.data()};});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());setProducts(products);});},[]);var loadCheckout=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(priceId){var docRef;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return db.collection('customers').doc(user.uid).collection('checkout_sessions').add({price:priceId,success_url:window.location.origin,cancel_url:window.location.origin});case 2:docRef=_context4.sent;docRef.onSnapshot(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(snap){var _snap$data,error,sessionId,stripe;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_snap$data=snap.data(),error=_snap$data.error,sessionId=_snap$data.sessionId;if(error){// Show an error to your customer and\n// inspect your Cloud Function logs in the Firebase console.\nalert(\"An error occurred: \".concat(error.message));}if(!sessionId){_context3.next=7;break;}_context3.next=5;return loadStripe('pk_test_51INN5wDIjfpbfl8KAzj99w8T6zQpxHj9O2rQu1YM0k1hdw4zCRadSDKHnVWZQ8a2JK08ra3k2xjQiD4B9z9gKFj900BmLcQ8By');case 5:stripe=_context3.sent;stripe.redirectToCheckout({sessionId:sessionId});case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x4){return _ref4.apply(this,arguments);};}());case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function loadCheckout(_x3){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"plansScreen\",children:[/*#__PURE__*/_jsx(\"br\",{}),subscription&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Renewal Date:\",new Date((subscription===null||subscription===void 0?void 0:subscription.current_period_end)*1000).toLocaleDateString()]}),Object.entries(products).map(function(_ref5){var _productData$name;var _ref6=_slicedToArray(_ref5,2),productId=_ref6[0],productData=_ref6[1];var isCurrentPackage=(_productData$name=productData.name)===null||_productData$name===void 0?void 0:_productData$name.toLowerCase().includes(subscription===null||subscription===void 0?void 0:subscription.role);return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(isCurrentPackage&&'plansScreen-plan-disabled',\" plansScreen-plan\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"plansScreen-info\",children:[/*#__PURE__*/_jsx(\"h5\",{children:productData.name}),/*#__PURE__*/_jsx(\"h6\",{children:productData.description})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return!isCurrentPackage&&loadCheckout(productData.prices.priceId);},children:isCurrentPackage?'Current Package':'Subscribe'})]},productId);})]});}export default PlansScreen;","map":{"version":3,"sources":["/Users/carlossantiagonevett/Documents/selfStudy/netflix-clone/src/components/PlansScreen.js"],"names":["React","useEffect","useState","useSelector","db","loadStripe","selectUser","PlansScreen","products","setProducts","user","subscription","setSubscription","collection","doc","uid","get","then","querySnapshot","forEach","role","data","current_period_end","seconds","current_period_start","console","log","where","productDoc","id","ref","priceSnap","docs","price","prices","priceId","priceData","loadCheckout","add","success_url","window","location","origin","cancel_url","docRef","onSnapshot","snap","error","sessionId","alert","message","stripe","redirectToCheckout","Date","toLocaleDateString","Object","entries","map","productId","productData","isCurrentPackage","name","toLowerCase","includes","description"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport db from '../firebase';\nimport './../styles/PlansScreen.css';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { selectUser } from './../features/userSlice';\n\nfunction PlansScreen() {\n  const [products, setProducts] = useState([]);\n  const user = useSelector(selectUser);\n  const [subscription, setSubscription] = useState(null);\n\n  useEffect(() => {\n    db.collection('customers')\n      .doc(user.uid)\n      .collection('subscriptions')\n      .get()\n      .then((querySnapshot) => {\n        querySnapshot.forEach(async (subscription) => {\n          setSubscription({\n            role: subscription.data().role,\n            current_period_end: subscription.data().current_period_end.seconds,\n            current_period_start: subscription.data().current_period_start\n              .seconds,\n          });\n        });\n      });\n  }, [user.uid]);\n\n  console.log(subscription);\n\n  useEffect(() => {\n    db.collection('products')\n      .where('active', '==', true)\n      .get()\n      .then((querySnapshot) => {\n        const products = {};\n        querySnapshot.forEach(async (productDoc) => {\n          products[productDoc.id] = productDoc.data();\n          const priceSnap = await productDoc.ref.collection('prices').get();\n          priceSnap.docs.forEach((price) => {\n            products[productDoc.id].prices = {\n              priceId: price.id,\n              priceData: price.data(),\n            };\n          });\n        });\n        setProducts(products);\n      });\n  }, []);\n\n  const loadCheckout = async (priceId) => {\n    const docRef = await db\n      .collection('customers')\n      .doc(user.uid)\n      .collection('checkout_sessions')\n      .add({\n        price: priceId,\n        success_url: window.location.origin,\n        cancel_url: window.location.origin,\n      });\n    docRef.onSnapshot(async (snap) => {\n      const { error, sessionId } = snap.data();\n\n      if (error) {\n        // Show an error to your customer and\n        // inspect your Cloud Function logs in the Firebase console.\n        alert(`An error occurred: ${error.message}`);\n      }\n      if (sessionId) {\n        // We have a session, let's redirect to Checkout\n        // Init Stripe\n\n        const stripe = await loadStripe(\n          'pk_test_51INN5wDIjfpbfl8KAzj99w8T6zQpxHj9O2rQu1YM0k1hdw4zCRadSDKHnVWZQ8a2JK08ra3k2xjQiD4B9z9gKFj900BmLcQ8By'\n        );\n        stripe.redirectToCheckout({ sessionId });\n      }\n    });\n  };\n\n  return (\n    <div className=\"plansScreen\">\n      <br />\n      {subscription && (\n        <p>\n          Renewal Date:\n          {new Date(\n            subscription?.current_period_end * 1000\n          ).toLocaleDateString()}\n        </p>\n      )}\n      {Object.entries(products).map(([productId, productData]) => {\n        const isCurrentPackage = productData.name\n          ?.toLowerCase()\n          .includes(subscription?.role);\n\n        return (\n          <div\n            key={productId}\n            className={`${\n              isCurrentPackage && 'plansScreen-plan-disabled'\n            } plansScreen-plan`}>\n            <div className=\"plansScreen-info\">\n              <h5>{productData.name}</h5>\n              <h6>{productData.description}</h6>\n            </div>\n            <button\n              onClick={() =>\n                !isCurrentPackage && loadCheckout(productData.prices.priceId)\n              }>\n              {isCurrentPackage ? 'Current Package' : 'Subscribe'}\n            </button>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nexport default PlansScreen;\n"]},"metadata":{},"sourceType":"module"}